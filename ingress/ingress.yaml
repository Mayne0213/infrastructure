---
# Jovies 네임스페이스의 Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: jovies-ingress
  namespace: jovies
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    # HTTP를 HTTPS로 자동 리다이렉트
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    # cert-manager가 인증서를 자동으로 발급하도록 설정
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  # TLS 설정
  tls:
  - hosts:
    - jovies.kro.kr
    - www.jovies.kro.kr
    # cert-manager가 이 이름으로 Secret을 자동 생성
    secretName: jovies-tls
  rules:
    - host: jovies.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: jovies-service
                port:
                  number: 80
    - host: www.jovies.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: jovies-service
                port:
                  number: 80

---
# Portfolio 네임스페이스의 Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: portfolio-ingress
  namespace: portfolio
  annotations:
    # HTTP를 HTTPS로 자동 리다이렉트
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    # cert-manager가 인증서를 자동으로 발급하도록 설정
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  # TLS 설정
  tls:
  - hosts:
    - minjo0213.kro.kr
    - www.minjo0213.kro.kr
    secretName: portfolio-tls
  rules:
    - host: minjo0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: portfolio-service
                port:
                  number: 80
    - host: www.minjo0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: portfolio-service
                port:
                  number: 80
---
# Todo 네임스페이스의 Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: todo-ingress
  namespace: todo
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    # HTTP를 HTTPS로 자동 리다이렉트
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    # cert-manager가 인증서를 자동으로 발급하도록 설정
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  # TLS 설정
  tls:
  - hosts:
    - todo0213.kro.kr
    - www.todo0213.kro.kr
    secretName: todo-tls
  rules:
    - host: todo0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: todo-service
                port:
                  number: 80
    - host: www.todo0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: todo-service
                port:
                  number: 80
---
# Jaejadle 네임스페이스의 Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: jaejadle-ingress
  namespace: jaejadle
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    # HTTP를 HTTPS로 자동 리다이렉트
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    # cert-manager가 인증서를 자동으로 발급하도록 설정
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  # TLS 설정
  tls:
  - hosts:
    - jaejadle.kro.kr
    - www.jaejadle.kro.kr
    secretName: jaejadle-tls
  rules:
    - host: jaejadle.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: jaejadle-service
                port:
                  number: 80
    - host: www.jaejadle.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: jaejadle-service
                port:
                  number: 80
---
# Joossam 네임스페이스의 Ingress (FastAPI OMR Grading API)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: joossam-ingress
  namespace: joossam
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    # HTTP를 HTTPS로 자동 리다이렉트
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    # cert-manager가 인증서를 자동으로 발급하도록 설정
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    # CORS 설정 (Vercel 프론트엔드 허용)
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-origin: "https://joossameng.com,https://*.com"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-headers: "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization"
spec:
  ingressClassName: nginx
  # TLS 설정
  tls:
  - hosts:
    - joossameng.kro.kr
    - www.joossameng.kro.kr
    secretName: joossam-tls
  rules:
    - host: joossameng.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: joossam-service
                port:
                  number: 80
    - host: www.joossameng.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: joossam-service
                port:
                  number: 80
---
# Grafana 네임스페이스의 Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: grafana-ingress
  namespace: monitoring
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    # HTTP를 HTTPS로 자동 리다이렉트
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    # cert-manager가 인증서를 자동으로 발급하도록 설정
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  # TLS 설정
  tls:
  - hosts:
    - grafana0213.kro.kr
    - www.grafana0213.kro.kr
    secretName: grafana-tls
  rules:
    - host: grafana0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: grafana
                port:
                  number: 80
    - host: www.grafana0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: grafana
                port:
                  number: 80

---
# Jovies Dev 네임스페이스의 Ingress (Development)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: jovies-dev-ingress
  namespace: jovies-dev
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    # HTTP를 HTTPS로 자동 리다이렉트
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    # cert-manager가 인증서를 자동으로 발급하도록 설정
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  # TLS 설정
  tls:
  - hosts:
    - dev.jovies.kro.kr
    secretName: jovies-dev-tls
  rules:
    - host: dev.jovies.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: jovies-service
                port:
                  number: 80

---
# Todo Dev 네임스페이스의 Ingress (Development)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: todo-dev-ingress
  namespace: todo-dev
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - dev.todo0213.kro.kr
    secretName: todo-dev-tls
  rules:
    - host: dev.todo0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: todo-service
                port:
                  number: 80

---
# Jaejadle Dev 네임스페이스의 Ingress (Development)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: jaejadle-dev-ingress
  namespace: jaejadle-dev
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - dev.jaejadle.kro.kr
    secretName: jaejadle-dev-tls
  rules:
    - host: dev.jaejadle.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: jaejadle-service
                port:
                  number: 80

---
# Portfolio Dev 네임스페이스의 Ingress (Development)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: portfolio-dev-ingress
  namespace: portfolio-dev
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - dev.minjo0213.kro.kr
    secretName: portfolio-dev-tls
  rules:
    - host: dev.minjo0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: portfolio-service
                port:
                  number: 80

---
# Joossam Dev 네임스페이스의 Ingress (Development)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: joossam-dev-ingress
  namespace: joossam-dev
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - dev.joossameng.kro.kr
    secretName: joossam-dev-tls
  rules:
    - host: dev.joossameng.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: joossam-service
                port:
                  number: 80

---
# MinIO S3 API Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: minio-api
  namespace: minio
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/proxy-body-size: "0"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - s3.minio0213.kro.kr
    secretName: minio-api-tls
  rules:
  - host: s3.minio0213.kro.kr
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: minio-service
            port:
              number: 9000

---
# MinIO Console Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: minio-console
  namespace: minio
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/proxy-body-size: "0"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - minio.minio0213.kro.kr
    - minio0213.kro.kr
    secretName: minio-console-tls
  rules:
  - host: minio.minio0213.kro.kr
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: minio-service
            port:
              number: 9001
  - host: minio0213.kro.kr
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: minio-service
            port:
              number: 9001

---
# Kubernetes Dashboard Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: kubernetes-dashboard-ingress
  namespace: kubernetes-dashboard
  annotations:
    # HTTP를 HTTPS로 자동 리다이렉트
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    # cert-manager가 인증서를 자동으로 발급하도록 설정
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    # WebSocket 지원 (Dashboard에 필요)
    nginx.ingress.kubernetes.io/websocket-services: "kubernetes-dashboard-kong-proxy"
    # Kong 프록시는 HTTPS를 사용
    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
    # 프록시 버퍼 설정
    nginx.ingress.kubernetes.io/proxy-buffer-size: "16k"
    nginx.ingress.kubernetes.io/proxy-buffers-number: "4"
spec:
  ingressClassName: nginx
  # TLS 설정
  tls:
  - hosts:
    - kubernetes0213.kro.kr
    - www.kubernetes0213.kro.kr
    secretName: kubernetes-dashboard-tls
  rules:
    - host: kubernetes0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: kubernetes-dashboard-kong-proxy
                port:
                  number: 443
    - host: www.kubernetes0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: kubernetes-dashboard-kong-proxy
                port:
                  number: 443

---
# Umami Analytics Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: umami-ingress
  namespace: analytics
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - umami0213.kro.kr
    - www.umami0213.kro.kr
    secretName: umami-tls
  rules:
    - host: umami0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: umami
                port:
                  number: 3000
    - host: www.umami0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: umami
                port:
                  number: 3000

---
# pgweb Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: pgweb-ingress
  namespace: pgweb
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - pgweb0213.kro.kr
    - www.pgweb0213.kro.kr
    secretName: pgweb-tls
  rules:
    - host: pgweb0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: pgweb
                port:
                  number: 80
    - host: www.pgweb0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: pgweb
                port:
                  number: 80

---
# code-server Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: code-server-ingress
  namespace: dev-tools
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    # WebSocket 지원 (code-server에 필요)
    nginx.ingress.kubernetes.io/websocket-services: "code-server"
    # 프록시 타임아웃 설정 (장시간 연결 유지)
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - vscode0213.kro.kr
    - www.vscode0213.kro.kr
    secretName: code-server-tls
  rules:
    - host: vscode0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: code-server
                port:
                  number: 8080
    - host: www.vscode0213.kro.kr
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: code-server
                port:
                  number: 8080

---
# ArgoCD UI Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: argocd-server-ingress
  namespace: argocd
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    # ArgoCD는 내부적으로 HTTPS를 사용
    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
    # 자체 서명된 인증서 허용
    nginx.ingress.kubernetes.io/ssl-passthrough: "false"
    # 프록시 버퍼 설정
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-body-size: "0"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - argocd0213.kro.kr
    secretName: argocd-server-tls
  rules:
  - host: argocd0213.kro.kr
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: argocd-server
            port:
              number: 443