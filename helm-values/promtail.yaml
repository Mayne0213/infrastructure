# Promtail Helm Values
# Chart: https://grafana.github.io/helm-charts
# Log collector agent (DaemonSet on all nodes)

# Loki endpoint
config:
  clients:
    - url: http://loki.logging.svc.cluster.local:3100/loki/api/v1/push

  # Scrape configs
  snippets:
    pipelineStages:
      - cri: {}
    
    # Add common labels
    common:
      - action: replace
        source_labels:
          - __meta_kubernetes_pod_node_name
        target_label: node_name
      - action: replace
        source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - action: replace
        source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - action: replace
        source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - action: replace
        source_labels:
          - __meta_kubernetes_pod_label_app
        target_label: app

# Resources
resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 200m
    memory: 256Mi

# Tolerations to run on all nodes including master
tolerations:
  - key: node-role.kubernetes.io/master
    operator: Exists
    effect: NoSchedule
  - key: node-role.kubernetes.io/control-plane
    operator: Exists
    effect: NoSchedule

# ServiceMonitor disabled
serviceMonitor:
  enabled: false

