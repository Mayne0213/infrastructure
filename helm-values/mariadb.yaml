# MariaDB (Production) Helm Values
# Chart: https://github.com/bitnami/charts/tree/main/bitnami/mariadb
# Architecture: Primary + 2 Replicas with replication

fullnameOverride: mariadb

# Use latest tag (ARM64 compatible)
image:
  tag: latest

architecture: replication

auth:
  # Passwords are managed via SealedSecrets
  existingSecret: mariadb-root-password
  existingSecretKey: mariadb-root-password
  database: mydb
  username: bluemayne
  existingSecretForUser: mariadb-password
  existingSecretKeyForUser: mariadb-password
  replicationUser: replicator
  existingSecretForReplicationUser: mariadb-replication-password
  existingSecretKeyForReplicationUser: mariadb-replication-password

primary:
  persistence:
    enabled: true
    size: 30Gi
    storageClass: mariadb-local
  
  configuration: |-
    [mysqld]
    skip-name-resolve
    explicit_defaults_for_timestamp
    basedir=/opt/bitnami/mariadb
    datadir=/bitnami/mariadb/data
    plugin_dir=/opt/bitnami/mariadb/plugin
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    tmpdir=/opt/bitnami/mariadb/tmp
    max_allowed_packet=16M
    bind-address=*
    pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
    log-error=/opt/bitnami/mariadb/logs/mysqld.log
    character-set-server=utf8mb4
    collation-server=utf8mb4_unicode_ci
    slow_query_log=0
    long_query_time=10.0
    
    [client]
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    default-character-set=utf8mb4
    
    [manager]
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid

  resources:
    requests:
      memory: "512Mi"
      cpu: "100m"
    limits:
      memory: "2Gi"

secondary:
  replicaCount: 2
  persistence:
    enabled: true
    size: 30Gi
    storageClass: local-path
  
  resources:
    requests:
      memory: "512Mi"
      cpu: "100m"
    limits:
      memory: "2Gi"

# Metrics disabled due to mysqld-exporter image issues on ARM64
metrics:
  enabled: false

